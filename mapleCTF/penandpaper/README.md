# Pen and Paper

## Description 
A sweet classical cipher. Why use a computer when I have a pen and paper?

NOTE: please wrap the flag in maple{...}

Author: vEvergarden

## Files

### ciphertext.txt
```
OJUIMBBQXAMI VVW KKVEFNWDMXAG BKIQQJIUIX BH RDDQFQ IV XUWUKQDMOQGO CJEHEZ JN KRYTDRUOGMQMG ZWMKBQZBML BAPF FGEC IIZMFOHFMZOA BW QWDYD DVMMTEBRFKMX TBUQMP. HZ OPXAM FCFDDEZ VWVMBHFR, OMTUA LG HDPUDBLCTIH BEYBZMM BK M LUDOCIT XGQMQ, VQFQGD FN OMKBNZX SUFYFMG YTIDH GYPPZV EQMWUM UZOZBKIMB RUOGMQMG LVHSUYE.

KZRMIAWDMKPR, T EUUAFVT IAIBRF ER KMNA, AUDI VB BPX WQZHF WY NEXV OHAFZVBQHK. OQDFDKQXTKIE UZOJCGBXO QMSDKKBXL JTERQSQN, MVZGKOJQP NBTML, ZDP XZRXBHDDZFTUX TTOHOXSXYE BAIB OTCKUDZ WMKBMWQQUZB. ACVZTER PZUTVLL P CUQK NVLXOHFZDPUVZ WY RDXFFABKIXAFR OHUZXQXTXP, HDOXPLBVZ HKLCQFMQV TKS ZIKYHMMZQZ QMSDKKBBWV, TZIT ACGKBBLZR, MIL XCUIXB-WQT BVNKXHFHGOOCKM.

EMQFUXQIIVMP QMWMBM QV PDXUYZB T XEBITNHM WY UBKS-AUZPDGO IROLKUE, ZIVZFCS VDAH VTTPHUB OUKPXZL IA SGFOQGO-BSSD ODTXMWOKPBGYO KZHBWVLXR. FCM KPTIADDSQN HNBXK YYDDJZ ZMTI-INDXY LKMGXGUNI, ABUCEXIUMW XGUMZ QWDDQFE TVL BBBGQEUUBVO QWQ SDUOQKIE GAKU AA VZRMIAFHMBCG QG HMEUSGVZWQVD EDDEUOQOM BCRNHYMOQHV.

ONCBQOQMWZL JSYXUUM I OXGUUFK WY KKVEFNSDVXAQK QDAKI VVW BXZWZHGGZA BW DPUM MZ TLDTKIMFU. OAM YIPS OAG IZM IDAJYZS NHZ FH UYSQIMKMPFITZJIUNB. BETK CMK MQXTHXF MQMFVXAAXP HD OMGIBWZOPOXUO QFXTXJTZJMFDWGA, IPGMOT KKGXMXCMKOEDA IBMXRWR, JZ KZXXIUUUXK NAM ZGKOJASMTXPBZ BQYYUOQDML IA CMZDXNTTQT ZDP MMMZBBKQ VXMBA.

QWDNKST BAMAX ONCBQOQMQWGP, QEBDZBVO ZGXFFABZTXPXOH QZP KRJMKPTOTDUOG MVMEJEHQEOA ZMYFCQ JTZQK ADFAXR MZL TMTOC SE FCBVS IXWD EQVAWVXA BQERQNABWGXAE. OAGTTJHOPFHEZ, TTBMOPX JTUISBVO, MMT DZTXVBEBER BQMAXDMKXCBU MMM MALBCFYMX IMBZBYJFDE VA KWGQTESQZOA VIOFVMSU OPKWCZE FGU XIUGZBKIT ER XKGXMLVDZFTUX MVBDBMR.

DV BAB QMT, OPXG CDESUD V VWUJJZHJK JN PQZWXX EWDTEML FZCYHUYCTTA TWN NAGAMMZ ZNNUDEZKNZQMV BQMOOQVMA XCP HQDVYWZVB FGU DUIWZMXCOD AR KWJNPI BHKBOHOZTMWK YZ NINMZRPDCYZS LBOBQPX QEEZBL TDPUMIF HIEQKFDGR MOOWKA. PE JQOCVHTWZV BEZFDVNMA QD UHAGDX, METEU OJUIMBBQXAME MMFIQG PF JTZ YWZXCGAMJ JN PWGFCS JTQ GMFM VQMUDMOBWV LU BONQMAMKNOXFX PQAMGLXOH, UZEPZBVZ DGQ PUBQMIT LAQBP NBTGA HQBKDQ IGL KBEHBUQIB.
```
### source.py
```python
import string
import random

ALPHABET = string.ascii_uppercase


def generate_key():
    return [random.randint(0, 26) for _ in range(13)]


def generate_keystream(key, length):
    keystream = []
    while len(keystream) < length:
        keystream.extend(key)
        key = key[1:] + key[:1]
    return keystream


def encrypt(message, key):
    indices = [ALPHABET.index(c) if c in ALPHABET else c for c in message.upper()]
    keystream = generate_keystream(key, len(message))
    encrypted = []

    for i in range(len(indices)):
        if isinstance(indices[i], int):
            encrypted.append(ALPHABET[(keystream[i] + indices[i]) % 26])
        else:
            encrypted.append(indices[i])

    return "".join(encrypted)


with open("plaintext.txt", "r") as f:
    plaintext = f.read()

key = generate_key()
ciphertext = encrypt(plaintext, key)

with open("ciphertext.txt", "w") as f:
    f.write(ciphertext)
```
## Solve
Looking at the source code for this challenge it's clear that the ciphertext file was generated by this code and we need to somehow referce the proccess to decrypt it. There's a couple of things to notice in the source file, 
1. ```python
    def generate_key():
        return [random.randint(0, 26) for _ in range(13)]
    ```
    A key is a random sequence of integers from 0 to 26 with length 13. 

2. ```python
    def generate_keystream(key, length):
        keystream = []
        while len(keystream) < length:
            keystream.extend(key)
            key = key[1:] + key[:1]
        return keystream
    ```
    A key stream gets generated by concating key with itself until we get the desired length with the exception that the key gets shifted to the right once before it's concated again.

3. ```python
    indices = [ALPHABET.index(c) if c in ALPHABET else c for c in message.upper()]
    ```
    If a character is an alphabet character, push it's index to indices, otherwise just push the character itself to indices. 

4. ```python 
    for i in range(len(indices)):
            if isinstance(indices[i], int):
                encrypted.append(ALPHABET[(keystream[i] + indices[i]) % 26])
            else:
                encrypted.append(indices[i])
    ```
    This is the part where the encryption happends. The loop iterates over each element in the indices list, where each element corresponds to either the index of an uppercase English alphabet letter in ALPHABET or the original character itself if it's not in the alphabet.  If the current element at index i is an integer (indicating an alphabet character), the first if statement adds the corresponding encrypted character to the encrypted list. It does this by taking the sum of the keystream value at the same position `keystream[i]` and the index `indices[i]`, and then taking the result modulo 26 to ensure it wraps around within the 26 letters of the alphabet. This operation effectively encrypts the character. If the element is not an integer it appends itself to the encrypted message. After this loop is executed for all elements in indices, the encrypted list contains the encrypted version of the input message, which is the ciphertext that is given to us.

Now for us to decrypt this message we essentially have to find the key. After looking at the code for a while I thought of doing some educated guessings on what a character in the ciphertext could map to in the keystream and then going from there. I noticed there were a few one letter characters in the ciphertext that could map to either `I` or `A` and given the context for this message I assumed they would be `A`s so I gave it a try. 

The first letter was `M` in the first paraghraph that I mapped to `A`. Now A and M are 12 places appart so our key has to contain 12 somewhere. Since I was lazy and I didn't want to calculate exactly which part of the key is 12, I tries all 13 places to see which one game a plaintex back that had replaces M with A. This is the code I used to find the position of 12 in the key. 

```python
import string
import random

ALPHABET = string.ascii_uppercase

def generate_key():
    return [random.randint(0, 26) for _ in range(13)]

def generate_keystream(key, length):
    keystream = []
    while len(keystream) < length:
        keystream.extend(key)
        key = key[1:] + key[:1]
    return keystream

def decrypt(message, key):
    indices = [ALPHABET.index(c) if c in ALPHABET else c for c in message.upper()]
    keystream = generate_keystream(key, len(message))
    encrypted = []

    for i in range(len(indices)):
        if isinstance(indices[i], int):
            encrypted.append(ALPHABET[(- keystream[i] + indices[i]) % 26])
        else:
            encrypted.append(indices[i])

    return "".join(encrypted)

with open("ciphertext.txt", "r") as f:
    ciphertext = f.read()

for i in range(13):
    key = [0]*13
    key[i] = 12
    print(key)

    plaintext = decrypt(ciphertext, key)
    print("Decrypted Message:")
    print(plaintext)
    print("----------------------------------------------------")

```

This gave with the following "plaintext":
```
OJUIMBBQXOMI VVW KKVETNWDMXAG BKIEQJIUIX BH RRDQFQ IV XUWIKQDMOQGO CJSHEZ JN KRYTRRUOGMQMG ZWAKBQZBML BAPT FGEC IIZMFCHFMZOA BW QWDYD DVMMTEBRTKMX TBUQMP. HZ OPXAM FCTDDEZ VWVMBHTR, OMTUA LG HDPUDBLCTIH BEYBZMM BK A LUDOCIT XGEMQ, VQFQGD TN OMKBNZX SIFYFMG YTIDH GYPPZV EQMWIM UZOZBKIMB RUOGMQMG LVHSUYE.
```
which replaced M with A and the index at which this happened was 12. So now we know they key must be of the form `[_, _, _, _, _, _, _, _, _, 12, _, _, _]`.

I followed the same procedure for all the one letter words I could find, namely, `T, P, V`. At this point my plaintext and key looked like this:

```
[_, 21, _, 19, _, _, 19, _, 15, 12, _, _, _]
Decrypted Message:
OOUPMBIQIOMI AVD KRVPTNWDMXHG IKTEQJIUNE BO CRDQFQ IV EUHIKQDMTQNO CUSHEZ ON KYYERRUOGRQTG ZHAKBQZGMS BHAT FGEH PIZTFCHFMZTA BW QHDYD IVTMTLBCTKMX TIUQTP. HZ TPEAM FNTDDEE CWVTBSTR, TMAUA LR HDPUDILCAIS BEYBETM IK A LUDTCIT XREMQ, AQMQND TN OMPBUZE DIFYFML FTIDS GYPPEV EQTHIM UZTZIKITB RUOGRQTG SVSSUYE.

KZYMTOWDMPPY, A PIUAFAT IAPBCT ER KTNA, LIDI AB BPE HEZHF WF NLXG OHAFECBQOK. OQDFIKQXAKTS UZOOCNBEO EMSDKPBEL JESRQSQS, MVZRYOJQP NITMS, ZDP CZYXBODRZFTUC ATOOOISXYE BHIB OEQKUDE DMKIMHEQUZG. ACCZESR PEUAVLS A CUQP UVLEOSTZDPUVG WF CRXFFAGRIXHFC OHUZCQXTEP, HDOXULIVG SYLCQFRQC AKD ZIKYMMTZQZ EMSDKPBIWV, HZIT FCNKBILNR, MNL XCBIIB-WQY IVNRXSTHGOTCRM.

PAQFUCQPIVTP EMWMGM QV POLUYZG A XLBTHNHM WF UIKD-AUZPINO PRZZKUE, ZIVGFNG VDAM CTAPSIB OUPPEZS TO SGFTQNO-BDGD ODYXTWORAPGYO PZOBWCLLR. FHM KPAILDDSQS ONBEK MYDDOZ ZMAI-WNDXD SKMNXRINI, AIUCLXTIMW CGBMZ QHRDQFE AVL BMPGQEUZIVO QHE SDUTQKIL ROKU AF CZYMTOFHMBHG QN SAEUSGAZDQVD SDDEUTQVM INFNHYMTQOV.

CNCBQTQTWZS USYXUZM I VXRIUFK WF KRVPTNSDAXHQK QOOKI AVD BEZHNHGGEA BW DAIM MZ ALDAKTAFU. THM FIAG OAG IZM IOOJYZS NOZ FS UYSQNMRMWFTHZJIUSB. BEEY CMK MXXTOIT MQMKVEAAEP HD ORGPBWGOAOXUO QMXTEJENJMFIWNA, IAUMOT KRGXTXNAKOEIA IBTXCKR, OZ KZEXTIUUXK UAM ZRYOJASRAXPIZ PQYYUTQDMS TO CMZIXUTAQE ZDP RMTZIBVE VXMGA.

QHRNKST BHMAE CNCBQTQTQWNP, QEBIZIVO ZRXFFAGZAXPEOS QZP KYJMRPECTDUTG MVTEUSHQETA ZMFFNE JTEQR AKFLLR MZL TMAON SE FHIVS IIKD EQAAWVEA PQERQSAIWNXLS. OALTAJOOATHEZ, TABMOAL JTUNSIVO, AMT DETEVBLBSR BQRAEDMRXNBU MRM MASBNTYMX ITBZIYUTDE AA KWNQESSQZTA VIVFGASU TPRWCGE TGU XIBGZIKTH ER CRGXTLGRZFTUC MVIDMAR.

IV BHB EMT, TPEG COSSUD A CWUJUNHJK ON PQGHLX EWITLML FNCYHUDCATA THN NALATMZ ZYBUDEEKUZQTV PQMOTQCMA XND HQIVFWZCB TGU IUPWZTXNCD AR RWJUPT BHKBTOOZAMHY YZ SINMGRARCYZS LIOIQAL QEEEBS ADAIMIF MILQKFOUR MOTWRA. AS JQOHVOTWGV BEZFIVUMA QO UHALDE, TEESU OOUPMBIQIOME RMMIQN AT JTE FWZECROMJ ON PWNFNG JTQ NMFT GEMUDMTIWV LF BONQRAMKUOITX PQFMNLEOS, UZEUZIVG OUQ PUGQTIT WOQBP SBAGA SEBKDQ INL RBSHBUQNB.
```
At this point things were coming together. I noticed I had `IK` that was likely going to be `IN` so I tried that. And then I also noticed `AVD` is likely `AND` and `BHAT` is likely to be `THAT`. After trying all three I was left with the following key and ciphertext:
```
[_, 21, 8, 19, _, 8, 19, 23, 15, 12, _, _, _]
Decrypted Message:
OOMPMTITIOMI AND CRYPTNWDMPHG INTEQJIUNE TO CRDQFQ AV EXHIKQDMTING FUSHEZ OF KYBERRUOGRITG CHAKBQZGES THAT FGEH PIRTICHFMZTS BO THDYD INTMLLECTKMX LIUITS. HZ THEAE INTDDEE CWNTESTR, TEAUS OR HDPUVILUALS BEYBETM IN A LUDTUIL AREMQ, AIMING TN OMPTUZE DIFYFML FTAGS GYPPEN EITHIM UZTRIKATE RUOGRITG SYSSUYE.

KRYPTOWDMPHY, A PIUAFAL ISPECT ER CTNS, LIDI AT BHE HEZHF OF FLAG OHAFECBION. OQDFICQPANTS UZOOUNTER EMSDKPTEL MESRQSQS, MNCRYOJQP FITES, ZDP CRYXTOGRZFTUC ATGORISXYE THIT REQKUDE DMCIPHEQUZG. AUCCESR PEMAVDS A CUQP UVDERSTZDPUNG OF CRXFFAGRIPHIC OHUZCIXLES, HDOXUDING SYLCQFRIC AND ZIKYMETZIC EMSDKPTIWN, HZIT FUNKTIONR, MND XUBLIB-WQY IVFRASTHGOTURM.

PAQFUCIPINTS EMWMGE QN SOLUYZG A PLETHNHM OF MIND-AUZPINO PUZZKUE, RINGING VDAM CLASSIB OUPHEZS TO SGFTINO-EDGD ODYPTWGRAPGYO PROBOCOLR. FHE KHALLDDSQS ONTEN MYDDOR ZEAL-WNDXD SKENARINI, SIUULATIMW CYBMR THRDQFE AVD EMPGQEUZIVG THE SDUTIKAL ROKU AF CRYPTOFHMBHY QN SAEUSGARDQNG SDDEUTIVM INFNHYMTIOV.

CNCBQTITWRS USYXUZE I VARIUFK OF CRYPTNSDAPHQC TOOKI AND TECHNHGGES BO GAIM MZ ALVANTAFU. THM FLAG OAG AZE LOOJYZS FOR IS UYSQNERMWITHZJIUST. THEY CMK EXXLOIT MQMKNEASES HD ORYPBOGRAOXUO IMXLEMENJMFIONA, LAUMOT CRGPTANAKOEIS ITTACKR, OR KREATIUUXK UAE CRYOJASRAXHIC PQYYUTIDES TO CMZIPULATE ZDP RETZIEVE VXMGS.

THRNKST THMSE CNCBQTITQONS, QEBIRIVG CRXFFAGRAXHERS QZP CYJERSECTDUTY MNTHUSHQETS ZEFINE JTEIR SKILLR MZD TEARN SE FHIVK LIKD EQASWNED PQERQSSIONALS. OALLAJORATHEZ, LABERAL JTUNKIVG, AMT DELEVTLESR BQRSEDERANBU MRE MSSENTYMX ATBRIBUTDE AS KONTESSQZTS VAVIGASU THRWUGH TGU XABGRINTH ER CRGPTOGRZFTUC MNIGMAR.

IN THE EMT, THEG FOSSUD A CWMMUNHJK OF PIGHLX EWILLMD INCYHUDUATS WHN NALSTMR CYBUDEECUZITY PQMOTICMS AND HQINFWRCE TGU IMPWRTANCD AR RWBUST BHKBTOORAPHY YZ SANEGUARCYZS DIGITAL QEEETS AGAIMIF MALQCIOUR MOTORA. AS JQOHNOTOGY BEZFINUMS TO UHALVE, THESU OOMPMTITIOME REMIIN AT JTE FWREFROMJ OF PONING JTQ NMXT GEMUDMTIWN OF BONQRSMCURITX PQFENDERS, UZEURIVG OUQ PUGITIL WOQBP STAGS SEBKDQ ANL RESHBUQNT.
```
The plaintext is almost complete and now we can guess the rest of the key like we have done so far. Notice that `CRYPTNWDMPHG` is likely to be `CRYPTOGRAPHY` given the context of the challenge so I tried mapping those characters which each other and that gave me the full plaintext.

```
[12, 21, 8, 19, 8, 8, 19, 23, 15, 12, 25, 16, 12]
Decrypted Message:
COMPETITIONS AND CRYPTOGRAPHY INTERTWINE TO CREATE AN EXHILARATING FUSION OF CYBERSECURITY CHALLENGES THAT PUSH PARTICIPANTS TO THEIR INTELLECTUAL LIMITS. IN THESE INTENSE CONTESTS, TEAMS OR INDIVIDUALS COMPETE IN A VIRTUAL ARENA, AIMING TO CAPTURE DIGITAL FLAGS HIDDEN WITHIN INTRICATE SECURITY SYSTEMS.

CRYPTOGRAPHY, A PIVOTAL ASPECT OF CTFS, LIES AT THE HEART OF FLAG PROTECTION. PARTICIPANTS ENCOUNTER ENCRYPTED MESSAGES, ENCRYPTED FILES, AND CRYPTOGRAPHIC ALGORITHMS THAT REQUIRE DECIPHERING. SUCCESS DEMANDS A DEEP UNDERSTANDING OF CRYPTOGRAPHIC PRINCIPLES, INCLUDING SYMMETRIC AND ASYMMETRIC ENCRYPTION, HASH FUNCTIONS, AND PUBLIC-KEY INFRASTRUCTURE.

PARTICIPANTS ENGAGE IN SOLVING A PLETHORA OF MIND-BENDING PUZZLES, RANGING FROM CLASSIC CIPHERS TO CUTTING-EDGE CRYPTOGRAPHIC PROTOCOLS. THE CHALLENGES OFTEN MIRROR REAL-WORLD SCENARIOS, SIMULATING CYBER THREATS AND EMPHASIZING THE CRITICAL ROLE OF CRYPTOGRAPHY IN SAFEGUARDING SENSITIVE INFORMATION.

COMPETITORS UTILIZE A VARIETY OF CRYPTOGRAPHIC TOOLS AND TECHNIQUES TO GAIN AN ADVANTAGE. THE FLAG YOU ARE LOOKING FOR IS VIGENEREWITHATWIST. THEY MAY EXPLOIT WEAKNESSES IN CRYPTOGRAPHIC IMPLEMENTATIONS, LAUNCH CRYPTANALYSIS ATTACKS, OR CREATIVELY USE CRYPTOGRAPHIC PRIMITIVES TO MANIPULATE AND RETRIEVE FLAGS.

THROUGH THESE COMPETITIONS, ASPIRING CRYPTOGRAPHERS AND CYBERSECURITY ENTHUSIASTS REFINE THEIR SKILLS AND LEARN TO THINK LIKE SEASONED PROFESSIONALS. COLLABORATION, LATERAL THINKING, AND RELENTLESS PERSEVERANCE ARE ESSENTIAL ATTRIBUTES AS CONTESTANTS NAVIGATE THROUGH THE LABYRINTH OF CRYPTOGRAPHIC ENIGMAS.

IN THE END, THEY FOSTER A COMMUNITY OF HIGHLY SKILLED INDIVIDUALS WHO BOLSTER CYBERSECURITY PRACTICES AND REINFORCE THE IMPORTANCE OF ROBUST CRYPTOGRAPHY IN SAFEGUARDING DIGITAL ASSETS AGAINST MALICIOUS ACTORS. AS TECHNOLOGY CONTINUES TO EVOLVE, THESE COMPETITIONS REMAIN AT THE FOREFRONT OF HONING THE NEXT GENERATION OF CYBERSECURITY DEFENDERS, ENSURING OUR DIGITAL WORLD STAYS SECURE AND RESILIENT.
```
Looking through the message we find this line `THE FLAG YOU ARE LOOKING FOR IS VIGENEREWITHATWIST` which is the flag. 

## Exploit 
```python
import string
import random

ALPHABET = string.ascii_uppercase

def generate_key():
    return [random.randint(0, 26) for _ in range(13)]

def generate_keystream(key, length):
    keystream = []
    while len(keystream) < length:
        keystream.extend(key)
        key = key[1:] + key[:1]
    return keystream

def decrypt(message, key):
    indices = [ALPHABET.index(c) if c in ALPHABET else c for c in message.upper()]
    keystream = generate_keystream(key, len(message))
    encrypted = []

    for i in range(len(indices)):
        if isinstance(indices[i], int):
            encrypted.append(ALPHABET[( -keystream[i] + indices[i]) % 26])
        else:
            encrypted.append(indices[i])

    return "".join(encrypted)

with open("ciphertext.txt", "r") as f:
    ciphertext = f.read()


for i in range(13):
    key = [0]*13
    key[9] = 12
    key[6] = 19
    key[3] = 19
    key[8] = 15
    key[1] = 21
    key[7] = 23
    key[2] = 8
    key[5] = 8
    key[4] = 8
    key[10] = 25
    key[11] = 16
    key[12] = 12
    key[12] = 12
    if i not in [9,6,3,8,1,7,2,5,4,10,11,12]:
        key[i] = 12
    else:
        continue
    print(key)

    plaintext = decrypt(ciphertext, key)
    print("Decrypted Message:")
    print(plaintext)
    print("----------------------------------------------------")

print(key)
```
## Flag 

`maple{VIGENEREWITHATWIST}`